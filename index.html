<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Paste (no storage)</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --accent-2: #3b82f6;
      --danger: #ef4444;
      --border: #1f2937;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    header, footer {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.25);
    }
    header h1 { margin: 0; font-size: 18px; }
    header p { margin: 6px 0 0; color: var(--muted); font-size: 13px; }

    main { padding: 16px; display: grid; gap: 12px; }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
    }

    textarea {
      width: 100%;
      min-height: 50vh;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace;
      font-size: 13px;
      line-height: 1.4;
      outline: none;
    }

    .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .row.inline { align-items: stretch; }

    button {
      appearance: none;
      border: 1px solid var(--border);
      background: #0b1220;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    button.primary { background: var(--accent-2); border-color: transparent; }
    button.success { background: var(--accent); border-color: transparent; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    input[type="text"] {
      flex: 1 1 auto;
      min-width: 240px;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
    }

    .hint { color: var(--muted); font-size: 12px; }
    .warn { color: var(--danger); }
    .ok { color: var(--accent); }

    footer { border-top: 1px solid var(--border); border-bottom: none; font-size: 12px; color: var(--muted); }
    a { color: #93c5fd; }
  </style>
</head>
<body>
  <header>
    <h1>Simple Paste</h1>
    <p>No accounts. No servers. Your text is encoded into the URL after the # (never sent to a server). Share the link to view anywhere.</p>
  </header>
  <main>
    <section class="panel">
      <textarea id="editor" placeholder="Paste or type your text here..."></textarea>
      <div class="row" style="margin-top: 10px;">
        <button id="copyTextBtn">Copy text</button>
        <button id="createLinkBtn" class="primary">Create/refresh link</button>
        <button id="copyLinkBtn" class="success">Copy link</button>
        <span id="status" class="hint" role="status" aria-live="polite"></span>
      </div>
    </section>

    <section class="panel">
      <div class="row inline">
        <input id="shareLink" type="text" readonly placeholder="Your shareable link will appear here" />
      </div>
      <div class="row" style="margin-top:8px;">
        <span id="metrics" class="hint"></span>
      </div>
      <div class="row" style="margin-top:6px;">
        <label class="hint"><input id="autoUpdate" type="checkbox" /> Auto-update link as you type</label>
        <button id="clearBtn" style="margin-left:auto;">Clear</button>
      </div>
    </section>
  </main>
  <footer>
    Tip: Very large texts produce long links. Most browsers support long URLs, but some apps may truncate them. For huge files, consider sharing a file instead.
  </footer>

  <!-- Compression library for compact, URL-safe encoding in the hash fragment -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
  <script>
    (function() {
      const $ = (id) => document.getElementById(id);
      const editor = $('editor');
      const shareLink = $('shareLink');
      const statusEl = $('status');
      const metricsEl = $('metrics');
      const autoUpdate = $('autoUpdate');
      const copyTextBtn = $('copyTextBtn');
      const createLinkBtn = $('createLinkBtn');
      const copyLinkBtn = $('copyLinkBtn');
      const clearBtn = $('clearBtn');

      function setStatus(msg, cls) {
        statusEl.textContent = msg || '';
        statusEl.className = 'hint ' + (cls || '');
      }

      function encodeText(text) {
        // Compress and encode in a URL-safe way
        return LZString.compressToEncodedURIComponent(text);
      }
      function decodeText(encoded) {
        try { return LZString.decompressFromEncodedURIComponent(encoded) || ''; }
        catch (e) { return ''; }
      }

      function buildUrlFromText(text) {
        const encoded = encodeText(text);
        return window.location.origin + window.location.pathname + '#' + encoded;
      }

      function updateMetrics(text) {
        const encoded = encodeText(text);
        const linkLen = (window.location.origin + window.location.pathname + '#' + encoded).length;
        const chars = text.length;
        const warn = linkLen > 2000; // conservative advisory
        metricsEl.innerHTML = `Characters: ${chars} â€¢ Link length: ${linkLen} ${warn ? '<span class="warn">(long link)</span>' : ''}`;
      }

      function refreshLink(pushHistory = false) {
        const text = editor.value;
        const url = buildUrlFromText(text);
        shareLink.value = url;
        if (pushHistory) {
          window.location.hash = url.split('#')[1] || '';
        } else {
          history.replaceState(null, '', url);
        }
        updateMetrics(text);
      }

      async function copyToClipboard(text) {
        try {
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(text);
          } else {
            // Fallback
            const ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            document.body.appendChild(ta);
            ta.focus();
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
          }
          return true;
        } catch (e) {
          return false;
        }
      }

      // Load from hash on first visit
      function loadFromHash() {
        const hash = window.location.hash.slice(1);
        if (!hash) return;
        const text = decodeText(hash);
        if (typeof text === 'string') {
          editor.value = text;
          shareLink.value = window.location.href;
          updateMetrics(text);
          setStatus('Loaded text from link.', 'ok');
        }
      }

      // Wire up events
      createLinkBtn.addEventListener('click', () => {
        refreshLink(false);
        setStatus('Link updated.', 'ok');
      });

      copyLinkBtn.addEventListener('click', async () => {
        if (!shareLink.value) refreshLink(false);
        const ok = await copyToClipboard(shareLink.value);
        setStatus(ok ? 'Link copied to clipboard.' : 'Unable to copy link', ok ? 'ok' : 'warn');
      });

      copyTextBtn.addEventListener('click', async () => {
        const ok = await copyToClipboard(editor.value);
        setStatus(ok ? 'Text copied to clipboard.' : 'Unable to copy text', ok ? 'ok' : 'warn');
      });

      autoUpdate.addEventListener('change', () => {
        setStatus('');
      });

      editor.addEventListener('input', () => {
        if (autoUpdate.checked) {
          refreshLink(false);
        } else {
          updateMetrics(editor.value);
        }
      });

      clearBtn.addEventListener('click', () => {
        editor.value = '';
        shareLink.value = '';
        history.replaceState(null, '', window.location.origin + window.location.pathname);
        updateMetrics('');
        setStatus('Cleared.', '');
      });

      // Init
      updateMetrics('');
      loadFromHash();
    })();
  </script>
</body>
</html>
