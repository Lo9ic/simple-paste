<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Paste (personal)</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --accent-2: #3b82f6;
      --danger: #ef4444;
      --border: #1f2937;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    header, footer {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.25);
    }
    header h1 { margin: 0; font-size: 18px; }
    header p { margin: 6px 0 0; color: var(--muted); font-size: 13px; }

    main { padding: 16px; display: grid; gap: 12px; }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
    }

    textarea {
      width: 100%;
      min-height: 60vh;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, monospace;
      font-size: 13px;
      line-height: 1.4;
      outline: none;
    }

    .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

    button {
      appearance: none;
      border: 1px solid var(--border);
      background: #0b1220;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    button.primary { background: var(--accent-2); border-color: transparent; }
    button.success { background: var(--accent); border-color: transparent; }

    .hint { color: var(--muted); font-size: 12px; }
    .warn { color: var(--danger); }
    .ok { color: var(--accent); }

    footer { border-top: 1px solid var(--border); border-bottom: none; font-size: 12px; color: var(--muted); }
    a { color: #93c5fd; }
  </style>
</head>
<body>
  <header>
    <h1>Simple Paste</h1>
    <p>Single fixed link for personal use. Click Save to store the current text remotely; Reload fetches the latest saved text; Copy copies to your clipboard.</p>
  </header>
  <main>
    <section class="panel">
      <textarea id="editor" placeholder="Type or paste your text here..."></textarea>
      <div class="row" style="margin-top: 10px;">
        <button id="reloadBtn">Reload</button>
        <button id="saveBtn" class="primary">Save</button>
        <button id="copyTextBtn" class="success">Copy</button>
        <span id="status" class="hint" role="status" aria-live="polite"></span>
      </div>
    </section>
  </main>
  <footer>
    Saved remotely when you click Save. Anyone opening this link will see the latest saved text. Note: Requires server storage (e.g., Vercel KV) when deployed.
  </footer>

  <script>
    (function() {
      const $ = (id) => document.getElementById(id);
      const editor = $('editor');
      const statusEl = $('status');
      const saveBtn = $('saveBtn');
      const reloadBtn = $('reloadBtn');
      const copyTextBtn = $('copyTextBtn');

      function setStatus(msg, cls) {
        statusEl.textContent = msg || '';
        statusEl.className = 'hint ' + (cls || '');
      }

      async function reloadFromServer() {
        try {
          const res = await fetch('/api/paste');
          if (!res.ok) throw new Error('bad status');
          const data = await res.json();
          editor.value = typeof data.text === 'string' ? data.text : '';
          setStatus('Reloaded latest saved text.', '');
        } catch (e) {
          setStatus('Unable to reload from server.', 'warn');
        }
      }

      async function saveToServer() {
        try {
          const res = await fetch('/api/paste', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: editor.value })
          });
          if (!res.ok) throw new Error('bad status');
          setStatus('Saved to server.', 'ok');
        } catch (e) {
          setStatus('Unable to save to server.', 'warn');
        }
      }

      async function copyToClipboard(text) {
        try {
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(text);
          } else {
            const ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            document.body.appendChild(ta);
            ta.focus();
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
          }
          return true;
        } catch (e) {
          return false;
        }
      }

      // Events
      saveBtn.addEventListener('click', saveToServer);
      reloadBtn.addEventListener('click', reloadFromServer);
      copyTextBtn.addEventListener('click', async () => {
        const ok = await copyToClipboard(editor.value);
        setStatus(ok ? 'Text copied to clipboard.' : 'Unable to copy text', ok ? 'ok' : 'warn');
      });

      // Init: fetch latest from server
      reloadFromServer();
    })();
  </script>
</body>
</html>
